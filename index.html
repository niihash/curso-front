<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gerenciador de Cursos ‚Äî Frontend (fix alunos)</title>
    <style>
        :root {
            --bg: #0f1724;
            --muted: #9aa6b2;
            --accent: #F4322E;
            --glass: rgba(255, 255, 255, 0.03);
            --success: #16a34a;
            --danger: #ef4444;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            color-scheme: dark;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(180deg, #071021, #081325);
            color: #e6eef6;
            font-size: 14px
        }

        header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px
        }

        h1 {
            margin: 0;
            font-size: 20px
        }

        .base-url {
            margin-left: auto;
            color: var(--muted);
            background: var(--glass);
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 13px
        }

        .container {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 20px;
            min-height: 60vh
        }

        nav {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
            border-radius: 12px;
            padding: 12px
        }

        .tab {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 6px
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.02)
        }

        .tab.active {
            background: linear-gradient(90deg, rgba(244, 50, 46, 0.12), rgba(244, 50, 46, 0.05));
            box-shadow: 0 4px 18px rgba(244, 50, 46, 0.06)
        }

        main {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
            padding: 16px;
            border-radius: 12px;
            min-height: 400px
        }

        .toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px
        }

        input,
        select,
        textarea {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 8px 10px;
            color: inherit;
            border-radius: 8px
        }

        button {
            background: var(--accent);
            color: white;
            border: 0;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600
        }

        button.ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06)
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px
        }

        th,
        td {
            text-align: left;
            padding: 8px 6px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.03);
            font-size: 13px
        }

        td.actions {
            display: flex;
            gap: 8px
        }

        .message {
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 10px
        }

        .message.info {
            background: rgba(255, 255, 255, 0.02)
        }

        .message.error {
            background: rgba(255, 0, 0, 0.06);
            color: #ffcccc
        }

        .small {
            font-size: 12px;
            color: var(--muted)
        }

        footer {
            margin-top: 18px;
            color: var(--muted);
            font-size: 13px
        }

        @media (max-width:900px) {
            .container {
                grid-template-columns: 1fr;
                padding-bottom: 40px
            }

            ;

            nav {
                order: 2
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Gerenciador de Cursos ‚Äî Frontend (fix alunos)</h1>
        <div class="base-url">Backend: https://gerenciador-de-cursos.onrender.com/</div>
    </header>

    <div class="container">
        <nav>
            <div class="tab active" data-resource="cursos">üìö Cursos</div>
            <div class="tab" data-resource="alunos">üßë‚Äçüéì Alunos</div>
            <div class="tab" data-resource="professores">üë®‚Äçüè´ Professores</div>
            <div class="tab" data-resource="disciplinas">üìò Disciplinas</div>

            <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:12px 0">
            <div class="small">Instru√ß√µes r√°pidas</div>
            <ul class="small" style="padding-left:18px">
                <li>Use as abas para trocar de recurso.</li>
                <li>Clique em "Novo" para abrir formul√°rio de cria√ß√£o.</li>
            </ul>
        </nav>

        <main>
            <div id="messages"></div>

            <div class="toolbar">
                <input type="text" id="searchInput" placeholder="Buscar (nome / email / descri√ß√£o)..." style="flex:1" />
                <select id="sortSelect" title="Ordenar">
                    <option value="id">Ordenar por ID</option>
                    <option value="nome">Ordenar por Nome</option>
                </select>
                <button id="searchBtn" class="ghost">üîé Buscar</button>
                <button id="newBtn">‚ûï Novo</button>
                <button id="refreshBtn" class="ghost">‚ü≥ Atualizar</button>
            </div>

            <section id="listSection"></section>

            <section id="formSection" style="display:none;margin-top:12px">
                <div
                    style="background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px">
                    <h3 id="formTitle">Novo</h3>
                    <form id="resourceForm">
                        <div id="formFields" style="display:grid;gap:10px"></div>
                        <div style="margin-top:10px;display:flex;gap:8px;">
                            <button type="submit" id="saveBtn">Salvar</button>
                            <button type="button" id="cancelBtn" class="ghost">Cancelar</button>
                        </div>
                    </form>
                </div>
            </section>

            <footer>
                UI simples | Consumindo API dispon√≠vel em <span
                    class="small">https://gerenciador-de-cursos.onrender.com/</span>
            </footer>
        </main>
    </div>

    <script>
        const BASE = 'https://gerenciador-de-cursos.onrender.com';
        const resources = {
            cursos: {
                label: 'Cursos', path: '/cursos', searchPath: '/cursos/search', fields: [
                    { name: 'id', label: 'ID', type: 'number', readOnly: true },
                    { name: 'nome', label: 'Nome', type: 'text', required: true },
                    { name: 'descricao', label: 'Descri√ß√£o', type: 'textarea' },
                    { name: 'cargaHoraria', label: 'Carga Hor√°ria', type: 'number' }
                ]
            },
            alunos: {
                label: 'Alunos', path: '/alunos', searchPath: '/alunos/search', fields: [
                    { name: 'id', label: 'ID', type: 'number', readOnly: true },
                    { name: 'nome', label: 'Nome', type: 'text', required: true },
                    { name: 'email', label: 'Email', type: 'text', required: true },
                    { name: 'sexo', label: 'Sexo', type: 'text' }
                ]
            },
            professores: {
                label: 'Professores', path: '/professores', searchPath: '/professores/search', fields: [
                    { name: 'id', label: 'ID', type: 'number', readOnly: true },
                    { name: 'nome', label: 'Nome', type: 'text', required: true },
                    { name: 'email', label: 'Email', type: 'text', required: true }
                ]
            },
            disciplinas: {
                label: 'Disciplinas', path: '/disciplinas', searchPath: '/disciplinas/search', fields: [
                    { name: 'id', label: 'ID', type: 'number', readOnly: true },
                    { name: 'nome', label: 'Nome', type: 'text', required: true },
                    { name: 'descricao', label: 'Descri√ß√£o', type: 'textarea' }
                ]
            }
        };

        let state = { resource: 'cursos', list: [], editing: null, page: 1, size: 50 };

        const el = s => document.querySelector(s);
        const els = s => document.querySelectorAll(s);

        function showMessage(msg, type = 'info', timeout = 4000) {
            const d = document.createElement('div');
            d.className = 'message ' + (type === 'error' ? 'error' : 'info');
            d.textContent = msg;
            el('#messages').appendChild(d);
            setTimeout(() => d.remove(), timeout);
        }
        function clearMessages() { el('#messages').innerHTML = '' }

        function setActiveTab(name) {
            state.resource = name;
            els('.tab').forEach(t => t.classList.toggle('active', t.dataset.resource === name));
            el('#searchInput').value = '';
            el('#formSection').style.display = 'none';
            state.editing = null;
            loadList();
        }

        /* ===== robust getDisplayValue =====
           - For 'alunos' we return explicit fields only (no fallback into cursos).
           - Generic behavior for other resources: primitive => string, array => join nomes (only when field is array),
             object => obj.nome || obj.name || JSON.
        */
        function getDisplayValue(item, field) {
            if (!item) return '';

            // Explicit behavior for ALUNOS to avoid any fallback that picks cursos' nomes
            if (state.resource === 'alunos') {
                const k = field.name;
                if (k === 'id') return item.id ?? '';
                if (k === 'nome') return item.nome ?? '';
                if (k === 'email') return item.email ?? '';
                if (k === 'sexo') return item.sexo ?? '';
                // if other fields requested, just try direct property
                const direct = item[field.name];
                if (typeof direct === 'string' || typeof direct === 'number' || typeof direct === 'boolean') return String(direct);
                if (Array.isArray(direct)) return direct.map(x => (x && (x.nome || x.name)) ? (x.nome || x.name) : JSON.stringify(x)).join(', ');
                if (typeof direct === 'object' && direct !== null) return direct.nome ?? direct.name ?? JSON.stringify(direct);
                return '';
            }

            // Generic fallback for other resources:
            const val = item[field.name];
            if (val === null || val === undefined) return '';
            if (typeof val === 'string' || typeof val === 'number' || typeof val === 'boolean') return String(val);
            if (Array.isArray(val)) {
                return val.map(v => {
                    if (v === null || v === undefined) return '';
                    if (typeof v === 'string' || typeof v === 'number') return String(v);
                    if (typeof v === 'object') return v.nome ?? v.name ?? JSON.stringify(v);
                    return '';
                }).filter(Boolean).join(', ');
            }
            if (typeof val === 'object') {
                return val.nome ?? val.name ?? JSON.stringify(val);
            }
            return String(val);
        }

        function escapeHTML(s) { return String(s || '').replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }

        function buildListHTML(items) {
            const cfg = resources[state.resource];
            if (!items || items.length === 0) return `<div class="small">Nenhum ${cfg.label.toLowerCase()} encontrado.</div>`;
            let html = `<table><thead><tr>`;
            cfg.fields.forEach(f => html += `<th>${f.label}</th>`);
            html += `<th>A√ß√µes</th></tr></thead><tbody>`;
            items.forEach(it => {
                html += `<tr>`;
                cfg.fields.forEach(f => {
                    const v = getDisplayValue(it, f);
                    html += `<td>${escapeHTML(v)}</td>`;
                });
                html += `<td class="actions">
      <button class="ghost" data-action="view" data-id="${it.id}">Ver</button>
      <button class="ghost" data-action="edit" data-id="${it.id}">Editar</button>
      <button class="ghost" data-action="delete" data-id="${it.id}" style="border-color:rgba(255,0,0,0.12);color:var(--danger)">Excluir</button>
    </td></tr>`;
            });
            html += `</tbody></table>`;
            return html;
        }

        /* ===== API helpers ===== */
        async function apiFetch(path, opts = {}) {
            const url = BASE + path;
            try {
                const resp = await fetch(url, Object.assign({ headers: { 'Accept': 'application/json' } }, opts));
                if (resp.status === 204) return null;
                const text = await resp.text();
                try {
                    const json = text ? JSON.parse(text) : null;
                    if (!resp.ok) {
                        const msg = (json && json.message) ? json.message : `HTTP ${resp.status}`;
                        throw new Error(msg);
                    }
                    return json;
                } catch (e) {
                    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                    return text;
                }
            } catch (err) {
                throw err;
            }
        }

        async function loadList() {
            clearMessages();
            const cfg = resources[state.resource];
            showMessage('Carregando ' + cfg.label + '...', 'info', 800);
            try {
                const q = el('#searchInput').value.trim();
                let url = cfg.path;
                if (q) url = cfg.searchPath + '?q=' + encodeURIComponent(q) + '&page=1&size=' + state.size;
                const data = await apiFetch(url, { method: 'GET' });
                let items = [];
                if (Array.isArray(data)) items = data;
                else if (data && (data[cfg.label.toLowerCase()] || data.items)) items = data[cfg.label.toLowerCase()] || data.items;
                else if (data) items = Array.isArray(data) ? data : [data];
                state.list = items;
                renderList();
                showMessage('Dados carregados', 'info', 900);
            } catch (err) {
                console.error(err);
                showMessage('Erro ao carregar: ' + err.message, 'error', 5000);
            }
        }

        function renderList() {
            const section = el('#listSection');
            section.innerHTML = '';
            const cfg = resources[state.resource];
            const header = document.createElement('div');
            header.style.display = 'flex'; header.style.justifyContent = 'space-between'; header.style.marginBottom = '8px';
            header.innerHTML = `<div style="display:flex;gap:12px;align-items:center"><div class="small" style="background:var(--glass);padding:6px 10px;border-radius:8px">${cfg.label}</div>
    <div class="small" style="color:var(--muted)">Registros: ${state.list.length}</div></div><div class="small" style="color:var(--muted)">API: ${cfg.path}</div>`;
            section.appendChild(header);
            const wrap = document.createElement('div');
            wrap.innerHTML = buildListHTML(state.list);
            section.appendChild(wrap);

            wrap.querySelectorAll('button[data-action]').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const act = btn.dataset.action, id = btn.dataset.id;
                    if (act === 'view') return viewItem(id);
                    if (act === 'edit') return editItem(id);
                    if (act === 'delete') { if (!confirm('Confirma exclus√£o?')) return; await deleteItem(id); }
                });
            });
        }

        /* ===== CRUD UI (minimal) ===== */
        function buildFormFields(item = {}) {
            const cfg = resources[state.resource];
            const w = el('#formFields'); w.innerHTML = '';
            cfg.fields.forEach(f => {
                const row = document.createElement('div'); row.style.display = 'grid'; row.style.gap = '6px';
                const label = document.createElement('label'); label.className = 'small'; label.textContent = f.label + (f.required ? ' *' : '');
                row.appendChild(label);
                if (f.type === 'textarea') {
                    const ta = document.createElement('textarea'); ta.name = f.name; ta.rows = 3; ta.value = item[f.name] ?? ''; row.appendChild(ta);
                } else {
                    const inp = document.createElement('input'); inp.name = f.name; inp.type = f.type === 'number' ? 'number' : 'text'; inp.value = item[f.name] ?? ''; if (f.readOnly) inp.readOnly = true; row.appendChild(inp);
                }
                w.appendChild(row);
            });
        }

        async function viewItem(id) {
            clearMessages();
            const cfg = resources[state.resource];
            try {
                const data = await apiFetch(cfg.path + '/' + encodeURIComponent(id), { method: 'GET' });
                const item = Array.isArray(data) ? data[0] : data;
                el('#formSection').style.display = 'block';
                el('#formTitle').textContent = 'Visualizar ' + cfg.label.slice(0, -1);
                const wrap = el('#formFields'); wrap.innerHTML = '';
                cfg.fields.forEach(f => {
                    const lbl = document.createElement('div'); lbl.className = 'small'; lbl.textContent = f.label;
                    const val = document.createElement('div'); val.className = 'small'; val.style.color = 'var(--muted)'; val.textContent = getDisplayValue(item, f);
                    wrap.appendChild(lbl); wrap.appendChild(val);
                });
                el('#saveBtn').style.display = 'none';
            } catch (err) { showMessage('Erro: ' + err.message, 'error'); }
        }

        async function editItem(id) {
            clearMessages();
            const cfg = resources[state.resource];
            try {
                const data = await apiFetch(cfg.path + '/' + encodeURIComponent(id), { method: 'GET' });
                const item = Array.isArray(data) ? data[0] : data;
                state.editing = item;
                el('#formSection').style.display = 'block';
                el('#formTitle').textContent = 'Editar ' + cfg.label.slice(0, -1);
                buildFormFields(item);
                el('#saveBtn').style.display = 'inline-block';
            } catch (err) { showMessage('Erro: ' + err.message, 'error'); }
        }

        async function deleteItem(id) {
            clearMessages();
            const cfg = resources[state.resource];
            try {
                await apiFetch(cfg.path + '/' + encodeURIComponent(id), { method: 'DELETE' });
                showMessage('Exclu√≠do', 'info');
                loadList();
            } catch (err) { showMessage('Erro: ' + err.message, 'error'); }
        }

        async function submitForm(e) {
            e.preventDefault(); clearMessages();
            const cfg = resources[state.resource];
            const fd = new FormData(el('#resourceForm'));
            const payload = {};
            cfg.fields.forEach(f => {
                if (f.readOnly) return;
                const v = fd.get(f.name);
                if (v === null) return;
                payload[f.name] = f.type === 'number' ? (v === '' ? null : Number(v)) : v;
            });

            try {
                if (state.editing && state.editing.id) {
                    await apiFetch(cfg.path + '/' + encodeURIComponent(state.editing.id), { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    showMessage('Atualizado', 'info');
                } else {
                    await apiFetch(cfg.path, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    showMessage('Criado', 'info');
                }
                el('#formSection').style.display = 'none';
                state.editing = null;
                loadList();
            } catch (err) { showMessage('Erro ao salvar: ' + err.message, 'error'); }
        }

        /* ===== Wire UI ===== */
        document.addEventListener('DOMContentLoaded', () => {
            els('.tab').forEach(t => t.addEventListener('click', () => setActiveTab(t.dataset.resource)));
            el('#searchBtn').addEventListener('click', () => loadList());
            el('#refreshBtn').addEventListener('click', () => loadList());
            el('#newBtn').addEventListener('click', () => { state.editing = null; el('#formSection').style.display = 'block'; el('#formTitle').textContent = 'Novo ' + resources[state.resource].label.slice(0, -1); buildFormFields({}); el('#saveBtn').style.display = 'inline-block'; });
            el('#cancelBtn').addEventListener('click', () => { el('#formSection').style.display = 'none'; state.editing = null; });
            el('#resourceForm').addEventListener('submit', submitForm);
            el('#searchInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); loadList(); } });
            loadList();
        });
    </script>
</body>

</html>